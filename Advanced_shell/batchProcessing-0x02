#!/bin/bash
# File: fetch_multiple_pokemon

POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
OUTPUT_DIR="pokemon_data"
ERROR_FILE="errors.txt"
DELAY=2        # Delay between requests in seconds
MAX_RETRIES=3  # Max retry attempts per Pokémon

mkdir -p "$OUTPUT_DIR"
> "$ERROR_FILE"  # Clear previous errors

for POKEMON in "${POKEMON_LIST[@]}"; do
    echo "Fetching data for $POKEMON..."
    ATTEMPT=1
    SUCCESS=false

    while [ $ATTEMPT -le $MAX_RETRIES ]; do
        if curl -s -f "$API_URL/$POKEMON" -o "$OUTPUT_DIR/$POKEMON.json"; then
            echo "Saved data to $OUTPUT_DIR/$POKEMON.json ✅"
            SUCCESS=true
            break
        else
            echo "Attempt $ATTEMPT failed for $POKEMON. Retrying..."
            ((ATTEMPT++))
            sleep 1
        fi
    done

    if [ "$SUCCESS" = false ]; then
        echo "$(date '+%Y-%m-%d %H:%M:%S') - Failed to fetch data for $POKEMON after $MAX_RETRIES attempts" >> "$ERROR_FILE"
        echo "Error logged to $ERROR_FILE ❌"
    fi

    sleep "$DELAY"
done
